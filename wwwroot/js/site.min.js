function createPaging(n,t,i){var u="",r;if(t>n){var e=1,o=n,f=Math.floor(n/2);for(i>2&&i<=t-f&&(e=parseInt(i)-f,o=parseInt(i)+f),i>t-f&&(e=t-n+1,o=t),u+=createLeftButton(r,i,"double-left"),u+=createLeftButton(r,i,"left"),r=e;r<=o;r++)u+=createButton(r,i);u+=createRightButton(r,i,"right",t);u+=createRightButton(r,i,"double-right",t)}else for(r=1;r<=t;r++)u+=createButton(r,i);return u}function createLeftButton(n,t,i){var r="";return 1!=t&&(r=getBase().replace("{act?}","").replace("{pag}",i=="double-left"?1:parseInt(t)-1).replace("{pag}",'<span class="fa fa-angle-'+i+' fa-color-black"><\/span>')),r}function createRightButton(n,t,i,r){var u="";return r!=t&&(u=getBase().replace("{act?}","").replace("{pag}",i=="double-right"?r:parseInt(t)+1).replace("{pag}",'<span class="fa fa-angle-'+i+' fa-color-black"><\/span>')),u}function createButton(n,t){return getBase().replace("{act?}",n==t?" active":"").replace("{pag}",n).replace("{pag}",n)}function getBase(){return'<button type="button" class="btn {act?}" onclick="init({pag})">{pag}<\/button>'}function redirect(n){var t=$(n).data("controller"),i=$(n).data("action"),r=$(n).data("currentid");window.location.href=pathBase+getURL([t,i,r])}function calcularDetallePago(){var i;referencias=[];var r=$("#TipoMonedaId").val(),n=0,t=0;$("#referencias tbody tr").each(function(){let h=$(this).find(positions.fecha).find("input").val(),c=$(this).find(positions.fecha).attr("id-source"),l=$(this).find(positions.tipo_pago).find("a").editable("getValue").tipo_pago_id,a=$(this).find(positions.banco).find("a").editable("getValue").id_banco,u=$(this).find(positions.monto_efectivo).find("a").editable("getValue").monto_efectivo,f=$(this).find(positions.monto_cheq).find("a").editable("getValue").monto_cheq,e=$(this).find(positions.monto_minu).find("a").editable("getValue").monto_minu,o=$(this).find(positions.monto_trans).find("a").editable("getValue").monto_trans,v=$(this).find(positions.referencia).find("a").editable("getValue").referencia,s=$(this).find(positions.tasa_cambio).html();var i=parseFloat(u)+parseFloat(e)+parseFloat(f)+parseFloat(o);r==context.tipoMoneda.cordoba?(n=i,t=parseFloat(i)/parseFloat(s),$(this).find(positions.totalC).html(numeral(n).format("$0,0.00")),$(this).find(positions.totalD).html(numeral(t).format("$0,0.00"))):(n=parseFloat(i)*parseFloat(s),t=i,$(this).find(positions.totalC).html(numeral(n).format("$0,0.00")),$(this).find(positions.totalD).html(numeral(t).format("$0,0.00")));referencias.push({idSource:c,TipoPagoId:l,fecha:h,IdBanco:a,MontoEfectivo:parseFloat(u),MontoMinu:parseFloat(e),MontoCheq:parseFloat(f),MontoTrans:parseFloat(o),referencia:v,totalD:t,totalC:n})});i=referencias.reduce(function(n,t){return+n+ +t.totalD},0);$(".amountsDetalle li:eq(1)").html('<span class="pull-left">Total Dólares : <\/span><strong> $ '+numeral(i).format("$0,0.00")+"<\/strong>")}function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}var getURL,findTypeOfficial,newRecibo,printReport;(function(n){n.fn.datatable=function(t){var i=n.extend({columnsHead:null,columnsDisplay:null,data:null,pag:0,rows:0,totalRows:0,controller:null,id:null,callback:"redirect",columnsWithFormatDate:[],columnsWithFormatMoney:[]},t);return this.each(function(){var c=n(this),o,f,t,r,e;let u=parseInt(i.rows),s=parseInt(i.pag);if(o="<thead><tr>",n.each(i.columnsHead,function(n,t){o+="<th>"+t+"<\/th>"}),o+="<\/tr><\/thead>",f="<tbody>",t="",i.data.length||(t='<td colspan = "'+i.columnsDisplay.length+'"><div class="alert alert-warning text-center" role="alert">No se encontraron registros<\/div><td>',f+="<tr>"+t+"<\/tr>"),n.each(i.data,function(r,u){t="";n.each(i.columnsDisplay,function(r,f){var e,o;f.type?(e="",n.each(f.buttons,function(n,t){t=="edit"&&(e+='<a href="#" class ="btn btn-primary btn-xs"  onclick="'+i.callback+'(this);" data-controller="'+(i.controller?i.controller:"")+'" data-action="edit"   data-currentid="'+u[i.id]+'"  style="" class="tip-top" data-original-title="Editar">  <i style="color:white" class="fa fa-pencil"><\/i><\/a> ');t=="remove"&&(e+='<a href="#" class ="btn btn-danger btn-xs"   onclick="'+i.callback+'(this);" data-controller="'+(i.controller?i.controller:"")+'" data-action="delete" data-currentid="'+u[i.id]+'"  style="" class="tip-top" data-original-title="Eliminar"><i style="color:white" class="fa fa-remove"><\/i><\/a> ');t=="otherAction"&&(e+='<a href="#" class ="btn btn-danger btn-xs"   onclick="'+i.callback+'(this);" data-controller="'+(i.controller?i.controller:"")+'" data-action="EditRols" data-currentid="'+u[i.id]+'"  style="" class="tip-top" data-original-title="Eliminar"><i style="color:white" class="fa fa-list"><\/i><\/a> ');t=="anular"&&(e+='<a href="#" class ="btn btn-danger btn-xs"   onclick="anular(this);" data-controller="'+(i.controller?i.controller:"")+'" data-action="EditRols" data-currentid="'+u[i.id]+'"  style="" class="tip-top" data-original-title="Anular"><i style="color:white" class="fa fa-remove"><\/i><\/a> ')}),t+="<td>"+e+"<\/td>"):i.columnsWithFormatMoney.includes(f)?t+="<td>"+numeral(u[f]).format("$0,0.00")+"<\/td>":i.columnsWithFormatDate.includes(f)?t+="<td>"+moment(u[f]).format("DD-MM-YYYY")+"<\/td>":(o="",f=="estado"&&(u[f]=="Registrado"&&(o="text-primary"),u[f]=="Anulado"&&(o="text-danger")),f=="numRecibo"&&(o="text-bold"),t+='<td class="'+o+'">'+u[f]+"<\/td>")});f+="<tr>"+t+"<\/tr>"}),f+="<\/tbody>",r=i.totalRows,totalPages=r%u>0?Math.floor(r/u)+1:r/u,e="",r>u){var l=s*u-(u-1),h=s*u,a='<p style="float:left;">Montrando de '+l+" a "+(r<h?r:h)+" de unos "+r+"<\/p>";e+='<tfoot><tr><td colspan="'+i.columnsHead.length+'">'+a+'<div class="btn-group" role="group" aria-label="..." style="float:right;">';e+=createPaging(5,totalPages,i.pag)}e+="<\/div><\/td><\/tr><\/tfoot>";n(c).html(o+f+e)})}})(jQuery);getURL=n=>n.join("/"),function(n){n.fn.addNewReference=function(t){return this.each(function(){var u=new Date,f=u.getTime(),e=n(this);n(e).find("tbody").append("<tr><td id-source="+f+'><input type="text" placeholder="dd-mm-aaaa" class="datepicker selectorFecha" value="'+(t?moment(t.Fecha).format("DD-MM-YYYY"):"")+'"/><\/td><td><a data-value="'+(t?t.TipoPagoId:"")+'" class="teditable2 tipo_pago_id" href="#" data-type="select" data-name="tipo_pago_id" data-pk="1" data-title="Tipo de pago"><\/a><\/td><td><a data-value="'+(t?t.IdBanco:"")+'" class="editable2 id_banco" href="#" data-type="select" data-name="id_banco" data-pk="1" data-title="Banco"><\/a><\/td><td><a data-value="'+(t?t.Referencia:"")+'" class="editable2 selectorReferencia" href="#" data-name="referencia" data-original-title="Ingrese la referencia"><\/a><\/td><td><a data-value="'+(t?t.MontoEfectivo:"0.00")+'" class="editable2 monto_efectivo" href="#" data-name="monto_efectivo" data-original-title="Monto efectivo">0.00<\/a><\/td><td><a data-value="'+(t?t.MontoCheq:"0.00")+'" class="editable2 monto_cheq" href="#" data-name="monto_cheq" data-original-title="Monto del cheque">0.00<\/a><\/td><td><a data-value="'+(t?t.MontoMinu:"0.00")+'" class="editable2 monto_minu" href="#" data-name="monto_minu" data-original-title="Monto de la minuta">0.00<\/a><\/td><td><a data-value="'+(t?t.MontoTrans:"0.00")+'" class="editable2 monto_trans" href="#" data-name="monto_trans" data-original-title="Monto de la transferencia">0.00<\/a><\/td><td>'+(t?t.TipoCambio:"0.00")+'<\/td><td>0.00<\/td><td>0.00<\/td><td><a class="fa fa-remove fa-color-red a-type-cursor" onclick="removeReferencia(this);"><\/a><\/td><\/tr>');n(".tipo_pago_id").editable({emptytext:"Seleccione",source:[{value:1,text:"Efectivo"},{value:2,text:"Cheque"},{value:3,text:"Minuta"},{value:4,text:"Transferencia"}],validate:function(t){if(n.trim(t)=="")return"El valor es requerido";var i=r(this);if(i)return i}});n(".id_banco").editable({emptytext:"Seleccione",source:[{value:12,text:"BANPRO"},{value:22,text:"BANCO DE FINANZAS"},{value:1,text:"B.A.C."},{value:4,text:"BANCENTRO"},{value:36,text:"FICOSA"},{value:43,text:"MINISTERIO DE HACIENDA Y CREDITO PUBLICO"}],validate:function(t){if(n.trim(t)=="")return"El valor es requerido";var r=i(this);if(r)return r}});var i=n=>{var t=r(n);return t?t:(t=o(n),t?t:void 0)},r=t=>{let i=n(t).closest("tr").find(positions.tasa_cambio).html();if(!isNumber(n.trim(i))||parseInt(i)==0)return"La tasa de cambio no esta seleccionada, selecione una fecha"},o=t=>{let i=n(t).closest("tr").find(positions.tipo_pago).find("a.editable").editable("getValue").tipo_pago_id;if(!isNumber(n.trim(i)))return"Seleccione un tipo de pago válido"};n(".selectorReferencia").editable({emptytext:"Seleccione",validate:function(){var n=i(this);if(n)return n}});n(".monto_efectivo, .monto_minu, .monto_cheq, .monto_trans").editable({validate:function(t){var r=i(this);return r?r:n.trim(t)==""?"El valor es requerido":isNumber(n.trim(t))?void 0:"El valor debe ser numerico"},display:function(t){n(this).text(parseFloat(t).toFixed(2))}});n(".tipo_pago_id").on("save",function(t,i){var f=["tipo_pago","tasa_cambio","fecha","totalD","totalC"],r,u;for(r in positions)f.includes(r)||(r=="referencia"?n(this).closest("tr").find(positions[r]).find("a.editable").editable("setValue","",!0).editable("toggleDisabled",!1):n(this).closest("tr").find(positions[r]).find("a.editable").editable("setValue",0,!0).editable("toggleDisabled",!1));n(this).closest("tr").find(context.getPosition(i.newValue)).find("a.editable").editable("toggleDisabled",!0);i.newValue!=tipoPago.efectivo?(n(this).closest("tr").find(positions.referencia).find("a.editable").editable("toggleDisabled",!0).editable("setValue","",!0),n(this).closest("tr").find(positions.banco).find("a.editable").editable("toggleDisabled",!0).editable("setValue",0,!0).editable("show")):(u=this,setTimeout(function(){n(u).closest("tr").find(positions.monto_efectivo).find("a.editable").editable("show")},400))});n(".id_banco").on("save",function(){n(this).closest("tr").find(positions.referencia).find("a.editable").editable("show")});n(".monto_efectivo, .monto_minu, .monto_cheq, .monto_trans").on("shown",function(t,i){var f=n("#TipoMonedaId").val(),h=n(this).closest("tr").find(positions.tipo_pago).find("a.editable").editable("getValue").tipo_pago_id;let u=n(this).closest("tr").find(positions.tasa_cambio).html();var e=detalle.reduce(function(n,t){return+n+ +t.montodolar},0),o=n(this).closest("tr").find(positions.fecha).attr("id-source"),s=referencias.filter(n=>n.idSource!=o).reduce(function(n,t){return+n+ +t.totalD},0),r=e-s;f==context.tipoMoneda.cordoba&&isNumber(u)&&(r=parseFloat(u)*r);i.input.postrender=function(){parseFloat(i.input.$input[0].value)==0&&(i.input.$input[0].value=parseFloat(r).toFixed(4));i.input.$input.select()}});n(".monto_efectivo, .monto_minu, .monto_cheq, .monto_trans").on("hidden",function(n,t){t==="save"&&calcularDetallePago()});n(".selectorReferencia").on("save",function(){var t=n(this).closest("tr").find(positions.tipo_pago).find("a.editable").editable("getValue").tipo_pago_id;n(this).closest("tr").find(context.getPosition(t)).find("a.editable").editable("show")});n(".selectorFecha").datepicker({autoclose:!0,format:"dd-mm-yyyy",language:"es"});n(".selectorFecha").change(function(){var t=this,i=function(i){n(t).closest("tr").find(positions.tasa_cambio).html(i.dolares)},r=function(){n(t).closest("tr").find(positions.tasa_cambio).html('<span class="text-danger">Sin datos<\/span>')};findTypeOfficial(this.value,i,r)});n(".editable2").removeClass("tipo_pago_id").removeClass("id_banco").removeClass("monto_efectivo").removeClass("monto_minu").removeClass("monto_cheq").removeClass("monto_trans").removeClass("selectorReferencia");n(".datepicker").removeClass("selectorFecha")})};n.fn.dataSourceReference=function(t){return this.each(function(){var i=n(this);n("#referencias tbody tr").remove();t.forEach(t=>{n(i).addNewReference(t)})})};n.fn.addNewServicio=function(t){return this.each(function(){var u=n(this),i,r;n(u).find("tbody").append('<tr><td class="w25"><select class="select40 data-ajax"><option value="">Seleccione<\/option><\/select><\/td><td class="w40 text-center"><a href="#" data-name="precio"  data-original-title="Ingrese el precio" class="editable1 precio">'+(t?t.Precio:"0.00")+'<\/a><\/td><td class="w40"><a href="#" data-name="cantidad" data-original-title="Ingrese la cantidad" class="editable1 cantidad">'+(t?t.Cantidad:"1")+'<\/a><\/td><td class="w40">0.00<\/a><\/td><td><a class="fa fa-remove fa-color-red a-type-cursor" onclick="removeServicio(this);"><\/a><\/td><\/tr>');n(".precio, .cantidad").editable({validate:function(t){return n.trim(t)<=0?"El valor debe ser mayor a 0":n.trim(t)==""?"El valor es requerido":isNumber(n.trim(t))?void 0:"El valor debe ser numerico"},display:function(t){n(this).text(parseFloat(t).toFixed(2))}});n(".precio, .cantidad").on("shown",function(n,t){t.input.postrender=function(){t.input.$input.select()}});n(".precio, .cantidad").on("hidden",function(t,i){i==="save"&&calculate();n(this).closest("td").next("td").find("a.editable").editable("show")});i=n(".data-ajax").selectize({valueField:"Cuenta",labelField:"Nombre",searchField:"Nombre",options:servicios.slice(0,1500),create:!1,render:{option:function(n,t){return'<div><span class="title"><span class="cuenta"><i class="fa fa-book"><\/i> '+t(n.Cuenta)+'<\/span><\/span><p class="description"><i class="fa fa-'+(n.TipoCta!=4?"user user":"money money")+'"><\/i> '+t(n.Nombre)+'<\/p><p class="descriptionPadre">'+t(n.padre)+"<\/p><\/div>"},item:function(n,t){return"<div>"+('<span class="name">'+t(n.Nombre)+"<\/span>")+('<span class="account">'+t(n.Cuenta)+"<\/span>")+"<\/div>"}},onDropdownClose:function(t){n(t).closest("td").next("td").find("a.editable").editable("show")}});t&&(r=i[0].selectize,r.setValue(t.CtaContable.substring(4,t.CtaContable.length)));n(".editable1").removeClass("precio").removeClass("cantidad");n(".data-ajax").removeClass("data-ajax")})};n.fn.dataSourceServicio=function(t){return this.each(function(){var i=n(this);n("#servicios tbody tr").remove();t.forEach(t=>{n(i).addNewServicio(t)})})};n.fn.saving=function(){return this.each(function(){var t=n(this);n(t).data("original",n(t).html());n(t).html('Guardando... <span class="fa fa-spinner fa-pulse"><\/span>')})};n.fn.searching=function(){return this.each(function(){var t=n(this);n(t).data("original",n(t).html());n(t).html('Buscando... <span class="fa fa-spinner fa-pulse"><\/span>')})};n.fn.reset=function(){return this.each(function(){var t=n(this);n(t).html('<span class="fa fa-filter"><\/span> Filtrar')})}}(jQuery);findTypeOfficial=(n,t,i)=>{var r=moment(n,"DD-MM-YYYY").utc().format();$.get(pathBase+"IngresosEgresosCajas/FindTipoCambio",{fecha:r},t,"json").fail(i)};var removeServicio=n=>remove(n,calculate),removeReferencia=n=>remove(n,calcularDetallePago),remove=(n,t)=>{function i(){$(n).parent().parent().remove();t()}$(n).parent().parent().addClass("animated fadeOutDown");setTimeout(i,500)};var findEntity=n=>{var t={};return $("."+n).each(function(n,i){(i.tagName=="INPUT"||i.tagName=="SELECT")&&(t[$(i).attr("id")]=i.classList.contains("datepicker")?moment($(i).val(),"DD-MM-YYYY").utc().format():$(i).val())}),t},fieldsIsValid=n=>{var t=!0;return $("."+n).each(function(n,i){if((i.tagName=="INPUT"||i.tagName=="SELECT")&&i.type!="hidden"&&i.dataset.required&&(i.value==""||i.value=="0"||i.value==0||i.value==null)){var r=$(this).data("error-message");r&&($.notification($(this).data("error-message")),t=!1)}}),detalle.length==0&&($.notification("Debe registrar al menos un servicio"),t=!1),referencias.length==0&&($.notification("Debe registrar el detalle de pago"),t=!1),t},calculate=()=>{detalle=[];$("#servicios tbody tr").each(function(){var n=$(this).find("td:eq(0)").find("select").val();if(n.length){let t=$(this).find("td:eq(1)").find("a").editable("getValue").precio,i=$(this).find("td:eq(2)").find("a").editable("getValue").cantidad,r=parseFloat(t)*parseFloat(i);$(this).find("td:eq(3)").html(parseFloat(r).toFixed(2));detalle.push({cta_cuenta:n,montodolar:r,precio:parseFloat(t),cantidad:parseFloat(i)})}});var t=detalle.reduce(function(n,t){return+n+ +t.montocordoba},0),n=detalle.reduce(function(n,t){return+n+ +t.montodolar},0);$(".amountsServicio li:eq(1)").html('<span class="pull-left">Total Dólares : <\/span><strong>$ '+numeral(n).format("$0,0.00")+"<\/strong>")},context={ajax:{get:(n,t,i)=>{$.get(pathBase+n,t,i,"json")}},tipoMoneda:{cordoba:1,dolar:2},tipoPago:{efectivo:1,cheque:2,minuta:3,trans:4},pagoPosition:{fecha:"td:eq(0)",tipo_pago:"td:eq(1)",banco:"td:eq(2)",referencia:"td:eq(3)",monto_efectivo:"td:eq(4)",monto_minu:"td:eq(6)",monto_cheq:"td:eq(5)",monto_trans:"td:eq(7)",tasa_cambio:"td:eq(8)",totalD:"td:eq(9)",totalC:"td:eq(10)"},getPosition:n=>{return positions[["","monto_efectivo","monto_cheq","monto_minu","monto_trans"][n]]}},tipoPago=context.tipoPago,positions=context.pagoPosition,validateModel=n=>{var t=!0;return n&&(n.Idtipopago==3||n.Idtipopago==4||n.Idtipopago==6)&&(referencias.length||(t=!1,$("#btnShowReference").notification("Debe ingresar las referencias de deposito o transferencia",{position:"left"}))),t};$("#TipoMonedaId").change(function(){calcularDetallePago()});newRecibo=()=>{window.location.href=pathBase+"ingresosEgresosCajas/create"};printReport=()=>{window.open(`${pathBase}ingresosEgresosCajas/print/${Id.value}`,"_blank")};